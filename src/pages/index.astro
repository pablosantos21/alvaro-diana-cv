---
import Image from "astro/components/Image.astro";
import Layout from "../layouts/Layout.astro";
import principal from "../assets/principal.webp";
import principalMobile from "../assets/alvaro.webp";
import eventsData from "../data/staatsoper-alvaro-events.json";
import EventItem from "../components/EventItem.astro";

// Helper to format a human-friendly date range for a play's occurrences
function formatDateRange(occs) {
  if (!occs || occs.length === 0) return "";
  const dates = occs
    .slice()
    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
  const start = new Date(dates[0].date);
  const end = new Date(dates[dates.length - 1].date);
  const sameDay =
    start.getFullYear() === end.getFullYear() &&
    start.getMonth() === end.getMonth() &&
    start.getDate() === end.getDate();

  if (sameDay) {
    const day = start.getDate();
    const month = start.toLocaleDateString("es-ES", { month: "long" });
    const year = start.getFullYear();
    return `${day} ${month} ${year}`;
  }

  const sameMonth =
    start.getMonth() === end.getMonth() &&
    start.getFullYear() === end.getFullYear();
  if (sameMonth) {
    const dayStart = start.getDate();
    const dayEnd = end.getDate();
    const month = start.toLocaleDateString("es-ES", { month: "long" });
    const year = start.getFullYear();
    return `${dayStart}–${dayEnd} ${month} ${year}`;
  }
  const s = start.toLocaleDateString("es-ES", {
      day: "numeric",
      month: "short",
      year: "numeric",
    }),
    e = end.toLocaleDateString("es-ES", {
      day: "numeric",
      month: "short",
      year: "numeric",
    });
  return `${s} – ${e}`;
}

const plays = eventsData.plays || [];
const startOfToday = (() => {
  const d = new Date();
  d.setHours(0, 0, 0, 0);
  return d.getTime();
})();

// Build plays with upcoming occurrences and dateRange
const upcomingPlays = plays
  .map((play) => ({
    ...play,
    occurrences: (play.occurrences || [])
      .filter((o) => new Date(o.date).getTime() >= startOfToday)
      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime()),
  }))
  .filter((p) => (p.occurrences || []).length > 0)
  .sort(
    (a, b) =>
      new Date(a.occurrences[0].date).getTime() -
      new Date(b.occurrences[0].date).getTime()
  );

// Limit how many to show on the homepage (3 by default)
const homepagePlays = upcomingPlays.slice(0, 3).map((p) => ({
  ...p,
  dateRange: formatDateRange(p.occurrences),
  eventUrl:
    (p.occurrences && p.occurrences[0] && p.occurrences[0].eventUrl) || "",
}));
---

<Layout title="Álvaro Diana">
  <div
    class="relative min-h-[100dvh] bg-[url('../assets/principal.webp')] md:bg-[url('../assets/test1.webp')] bg-cover bg-no-repeat bg-center flex items-center"
  >
    <!-- <div class="absolute inset-0 bg-black/50"></div> -->
  </div>
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 lg:py-16">
    <div
      class="flex flex-col lg:flex-row items-center lg:items-start gap-8 lg:gap-12"
    >
      <div class="w-full lg:w-1/2 flex justify-center">

        {/* Desktop image (hidden on small screens) */}
        <Image
          src={principal}
          alt="Álvaro Diana"
          class="rounded-lg shadow-lg hidden md:block w-64 sm:w-80 md:w-96 lg:w-full max-w-md"
        />
      </div>
      <div class="w-full lg:w-1/2 text-center lg:text-left">
        <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-4 lg:mb-6">
          Álvaro Diana
        </h3>
        <p
          class="mb-6 lg:mb-8 text-gray-700 leading-relaxed text-base sm:text-lg max-w-2xl mx-auto lg:mx-0"
        >
          El tenor Español ha sido seleccionado para formar parte del roster de
          cantantes del Opernstudio de la Ópera Estatal de Berlín (Staatsoper
          Unter den Linden) en la temporada 2025-2026 donde interpretará roles
          como “Max” en Der Freischütz, “Flavio” en Norma, “Scaramuccio” en
          Ariadne auf Naxos, “Nathanäel” en Les Contes d'Hoffmann ,entre otros.
        </p>
        <div class="flex justify-center lg:justify-start">
          <a
            href="/biografia"
            class="inline-flex items-center px-6 py-3 bg-gray-900 text-white font-medium rounded-lg hover:bg-gray-800 transition-colors duration-200 text-sm sm:text-base"
          >
            Conoce mi historia
            <svg
              class="ml-2 w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Video Section -->
  <div class="bg-gray-50 py-16">
    <div class="max-w-4xl mx-auto px-6">
      <div
        class="relative aspect-video rounded-lg overflow-hidden shadow-xl bg-black"
      >
        <iframe
          class="w-full h-full"
          src="https://www.youtube.com/embed/4CrthhUFTho"
          title="Álvaro Diana - Performance"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- Testimonials Section -->
  <div class="bg-white py-16">
    <div class="max-w-6xl mx-auto px-6">
      <!-- Carousel Container -->
      <div class="relative overflow-hidden">
        <div
          id="testimonials-carousel"
          class="flex transition-transform duration-500 ease-in-out"
        >
          <!-- Testimonial 1 -->
          <div class="w-full flex-shrink-0 px-4">
            <div
              class="bg-gray-50 rounded-lg p-8 text-center max-w-4xl mx-auto"
            >
              <div class="text-4xl text-gray-400 mb-4">"</div>
              <p class="text-lg text-gray-700 mb-6 italic leading-relaxed">
                La voz de Álvaro Diana posee una calidad excepcional que combina
                técnica impecable con una sensibilidad artística extraordinaria.
                Su interpretación de Don Ottavio fue memorable.
              </p>
              <div class="flex items-center justify-center">
                <div>
                  <p class="font-semibold text-gray-900">
                    Maestro Giovanni Rossi
                  </p>
                  <p class="text-gray-600">
                    Director de Orquesta, Teatro Circo
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Testimonial 2 -->
          <div class="w-full flex-shrink-0 px-4">
            <div
              class="bg-gray-50 rounded-lg p-8 text-center max-w-4xl mx-auto"
            >
              <div class="text-4xl text-gray-400 mb-4">"</div>
              <p class="text-lg text-gray-700 mb-6 italic leading-relaxed">
                Un tenor con una musicalidad excepcional y una presencia
                escénica cautivadora. Álvaro aporta una interpretación fresca y
                auténtica a cada papel que interpreta.
              </p>
              <div class="flex items-center justify-center">
                <div>
                  <p class="font-semibold text-gray-900">María Fernández</p>
                  <p class="text-gray-600">
                    Directora Artística, Staatsoper Berlin
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Testimonial 3 -->
          <div class="w-full flex-shrink-0 px-4">
            <div
              class="bg-gray-50 rounded-lg p-8 text-center max-w-4xl mx-auto"
            >
              <div class="text-4xl text-gray-400 mb-4">"</div>
              <p class="text-lg text-gray-700 mb-6 italic leading-relaxed">
                Su técnica vocal es sólida y su capacidad para conectar
                emocionalmente con el público es verdaderamente notable. Un
                artista completo con gran futuro por delante.
              </p>
              <div class="flex items-center justify-center">
                <div>
                  <p class="font-semibold text-gray-900">Dr. Carlos Mendoza</p>
                  <p class="text-gray-600">Crítico Musical, El País</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <button
          id="prev-btn"
          class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-shadow duration-200 z-10 hidden sm:block"
        >
          <svg
            class="w-5 h-5 text-gray-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        <button
          id="next-btn"
          class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-shadow duration-200 z-10 hidden sm:block"
        >
          <svg
            class="w-5 h-5 text-gray-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
      </div>

      <!-- Dots Indicator -->
      <div class="flex justify-center mt-8 space-x-2">
        <button
          class="dot w-3 h-3 bg-gray-900 rounded-full transition-colors duration-200"
          data-slide="0"></button>
        <button
          class="dot w-3 h-3 bg-gray-300 rounded-full transition-colors duration-200"
          data-slide="1"></button>
        <button
          class="dot w-3 h-3 bg-gray-300 rounded-full transition-colors duration-200"
          data-slide="2"></button>
      </div>
    </div>
  </div>

  <!-- Latest Events Section -->
  <div class="bg-gray-50 py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          Próximos Eventos
        </h2>
        <p class="text-gray-600 max-w-2xl mx-auto">
          No te pierdas mis próximas actuaciones en algunos de los teatros más
          prestigiosos del mundo.
        </p>
      </div>

      <div class="space-y-6">
        {
          homepagePlays.map((play) => (
            <EventItem event={play} actionLabel="Ver evento" />
          ))
        }
      </div>

      <div class="text-center mt-10">
        <a
          href="/eventos"
          class="inline-flex items-center px-8 py-3 bg-gray-900 text-white font-medium rounded-lg hover:bg-gray-800 transition-colors duration-200"
        >
          Ver todos los eventos
          <svg
            class="ml-2 w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
            ></path>
          </svg>
        </a>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const carousel = document.getElementById("testimonials-carousel");
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");
      const dots = document.querySelectorAll(".dot");
      let currentSlide = 0;
      const totalSlides = 3;

      if (!carousel || !prevBtn || !nextBtn) return;

      function updateCarousel() {
        if (!carousel) return;
        const translateX = -currentSlide * 100;
        carousel.style.transform = `translateX(${translateX}%)`;

        // Update dots
        dots.forEach((dot, index) => {
          if (index === currentSlide) {
            dot.classList.remove("bg-gray-300");
            dot.classList.add("bg-gray-900");
          } else {
            dot.classList.remove("bg-gray-900");
            dot.classList.add("bg-gray-300");
          }
        });
      }

      function nextSlide() {
        currentSlide = (currentSlide + 1) % totalSlides;
        updateCarousel();
      }

      function prevSlide() {
        currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
        updateCarousel();
      }

      // Event listeners
      nextBtn.addEventListener("click", nextSlide);
      prevBtn.addEventListener("click", prevSlide);

      // Dot navigation
      dots.forEach((dot, index) => {
        dot.addEventListener("click", () => {
          currentSlide = index;
          updateCarousel();
        });
      });

      // Auto-play (optional)
      setInterval(nextSlide, 5000);
    });
  </script>
</Layout>
