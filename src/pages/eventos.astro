---
import Layout from "../layouts/Layout.astro";

// Upcoming events: add real events here (date in ISO format)
const upcomingEvents = [
  {
    date: "2025-03-15",
    title: "Die Zauberflöte",
    composer: "Mozart",
    role: "1er Priester",
    place: "Staatsoper Berlin",
    location: "Berlín, Alemania",
    category: "Ópera",
    stageDirector: "Robert Carsen",
    musicDirector: "Daniel Barenboim",
    ticketUrl: "https://example.com/tickets/zauberflote",
  },
  {
    date: "2026-04-08",
    title: "Turandot",
    composer: "Puccini",
    role: "Pang",
    place: "Teatro Pérez Galdós",
    location: "Las Palmas, España",
    category: "Ópera",
    stageDirector: "Franco Zeffirelli",
    musicDirector: "Sesto Quatrini",
    ticketUrl: "https://example.com/tickets/turandot",
  },
  {
    date: "2026-06-12",
    title: "Elisir d'Amore",
    composer: "Donizetti",
    role: "Nemorino",
    place: "Cover Xabier Anduaga",
    location: "Por confirmar",
    category: "Ópera",
    stageDirector: "Laurent Pelly",
    musicDirector: "Maurizio Benini",
    ticketUrl: "https://example.com/tickets/elisir",
  },
  {
    date: "2025-12-20",
    title: "Romeo et Juliette",
    composer: "Gounod",
    role: "Tybalt",
    place: "Staatsoper Berlin",
    location: "Berlín, Alemania",
    category: "Ópera",
    stageDirector: "Bartlett Sher",
    musicDirector: "Kirill Petrenko",
    ticketUrl: "https://example.com/tickets/romeo",
  },
  {
    date: "2026-05-15",
    title: "Tosca",
    composer: "Puccini",
    role: "Spoletta",
    place: "Staatsoper Berlin",
    location: "Berlín, Alemania",
    category: "Ópera",
    stageDirector: "Luc Bondy",
    musicDirector: "Antonio Pappano",
    ticketUrl: "https://example.com/tickets/tosca",
  },
];

// Previous events: archive of past shows
const previousEvents = [
  {
    date: "2024-09-15",
    title: "La Traviata",
    composer: "Verdi",
    role: "Alfredo",
    place: "Teatro Badajoz",
    location: "Badajoz, España",
    category: "Ópera",
    stageDirector: "Mario Gas",
    musicDirector: "Josep Pons",
    infoUrl: "https://example.com/info/traviata-badajoz-2024",
  },
  {
    date: "2024-06-10",
    title: "West Side Story",
    composer: "Bernstein",
    role: "Toni",
    place: "Teatro Huesca",
    location: "Huesca, España",
    category: "Musical",
    stageDirector: "Federico Barrios",
    musicDirector: "Silvia Sanz Torre",
    infoUrl: "https://example.com/info/west-side-story-huesca-2024",
  },
  {
    date: "2024-03-22",
    title: "Cendrillon",
    composer: "Viardot",
    role: "Prince Charmant",
    place: "Palau de les Arts",
    location: "Valencia, España",
    category: "Ópera",
    stageDirector: "Emilio Sagi",
    musicDirector: "Rubén Gimeno",
    infoUrl: "https://example.com/info/cendrillon-valencia-2024",
  },
  {
    date: "2023-11-15",
    title: "Don Giovanni",
    composer: "Mozart",
    role: "Don Ottavio",
    place: "Teatro Circo",
    location: "Mataró, España",
    category: "Ópera",
    stageDirector: "Calixto Bieito",
    musicDirector: "Giovanni Rossi",
    infoUrl: "https://example.com/info/don-giovanni-mataro-2023",
  },
  {
    date: "2023-07-08",
    title: "Le Nozze di Figaro",
    composer: "Mozart",
    role: "Don Basilio",
    place: "Palau de les Arts",
    location: "Valencia, España",
    category: "Ópera",
    stageDirector: "Laurent Pelly",
    musicDirector: "Gustavo Gimeno",
    infoUrl: "https://example.com/info/nozze-figaro-valencia-2023",
  },
];

function formatDate(dateStr: string) {
  const d = new Date(dateStr);
  return d.toLocaleDateString("es-ES", {
    day: "numeric",
    month: "long",
    year: "numeric",
  });
}

function formatDateShort(dateStr: string) {
  const d = new Date(dateStr);
  const day = d.getDate();
  const month = d.toLocaleDateString("es-ES", { month: "short" });
  return { day: day.toString(), month };
}

const upcoming = upcomingEvents
  .slice()
  .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
const previous = previousEvents
  .slice()
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<Layout title="Eventos">
  <!-- Hero Section -->
  <div
    class="min-h-screen bg-[url('../assets/biografia.jpeg')] bg-black/50 bg-blend-overlay bg-cover bg-center flex flex-col justify-end"
  >
    <h2 class="text-5xl text-white pl-20 font-semibold mb-10">Eventos</h2>
  </div>

  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <!-- Navigation Tabs -->
    <div class="mb-12">
      <nav
        role="tablist"
        aria-label="Eventos tabs"
        class="flex rounded-lg bg-gray-100 p-1 max-w-md mx-auto"
      >
        <button
          data-tab="upcoming"
          aria-selected="true"
          class="flex-1 px-6 py-3 bg-gray-900 text-white rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2"
        >
          Próximos
        </button>
        <button
          data-tab="previous"
          aria-selected="false"
          class="flex-1 px-6 py-3 text-gray-700 rounded-md font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2"
        >
          Anteriores
        </button>
      </nav>
    </div>

    <!-- Upcoming panel -->
    <div data-panel="upcoming">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          Próximos Eventos
        </h2>
        <p class="text-gray-600 max-w-2xl mx-auto">
          No te pierdas mis próximas actuaciones en algunos de los teatros más
          prestigiosos del mundo.
        </p>
      </div>

      {
        upcoming.length === 0 ? (
          <div class="text-center py-12">
            <p class="text-gray-500 text-lg">
              No hay eventos próximos por ahora.
            </p>
            <p class="text-gray-400 mt-2">
              Vuelve pronto para conocer las próximas fechas.
            </p>
          </div>
        ) : (
          <div class="space-y-6">
            {upcoming.map((event) => {
              const dateInfo = formatDateShort(event.date);
              return (
                <div class="border-b border-gray-200 pb-6">
                  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div class="flex-1">
                      <div class="flex items-center gap-3 mb-2">
                        <h3 class="text-xl font-semibold text-gray-900">
                          {event.title}
                        </h3>
                        <span class="text-sm text-gray-500">
                          {event.composer}
                        </span>
                      </div>
                      <p class="text-gray-600 mb-1">
                        {event.role} • {event.place}
                      </p>
                      <p class="text-sm text-gray-500 mb-2">{event.location}</p>
                      <div class="text-xs text-gray-500 space-y-1">
                        <p>Dir. Escena: {event.stageDirector}</p>
                        <p>Dir. Musical: {event.musicDirector}</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="text-lg font-medium text-gray-900">
                        {formatDate(event.date)}
                      </p>
                      <div class="flex items-center justify-end gap-3 mt-2">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                          {event.category}
                        </span>
                        <a
                          href={event.ticketUrl}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="inline-flex items-center px-3 py-1 bg-gray-900 text-white text-xs font-medium rounded hover:bg-gray-800 transition-colors duration-200"
                          aria-label={`Comprar entradas para ${event.title}`}
                        >
                          Entradas
                          <svg
                            class="ml-1 w-3 h-3"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                            />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )
      }
    </div>

    <!-- Previous panel -->
    <div data-panel="previous" hidden>
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          Eventos Anteriores
        </h2>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Un recorrido por las actuaciones más destacadas de mi carrera
          artística.
        </p>
      </div>

      {
        previous.length === 0 ? (
          <div class="text-center py-12">
            <p class="text-gray-500 text-lg">
              No hay eventos previos registrados.
            </p>
          </div>
        ) : (
          <div class="space-y-6">
            {previous.map((event) => {
              return (
                <div class="border-b border-gray-200 pb-6">
                  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div class="flex-1">
                      <div class="flex items-center gap-3 mb-2">
                        <h3 class="text-xl font-semibold text-gray-900">
                          {event.title}
                        </h3>
                        <span class="text-sm text-gray-500">
                          {event.composer}
                        </span>
                      </div>
                      <p class="text-gray-600 mb-1">
                        {event.role} • {event.place}
                      </p>
                      <p class="text-sm text-gray-500 mb-2">{event.location}</p>
                      <div class="text-xs text-gray-500 space-y-1">
                        <p>Dir. Escena: {event.stageDirector}</p>
                        <p>Dir. Musical: {event.musicDirector}</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="text-lg font-medium text-gray-900">
                        {formatDate(event.date)}
                      </p>
                      <div class="flex items-center justify-end gap-3 mt-2">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                          {event.category}
                        </span>
                        <a
                          href={event.infoUrl}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="inline-flex items-center px-3 py-1 bg-blue-600 text-white text-xs font-medium rounded hover:bg-blue-700 transition-colors duration-200"
                          aria-label={`Ver información sobre ${event.title}`}
                        >
                          Info
                          <svg
                            class="ml-1 w-3 h-3"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                            />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )
      }
    </div>
  </section>

  <script type="module">
    const tabButtons = Array.from(document.querySelectorAll("[data-tab]"));
    const panels = Array.from(document.querySelectorAll("[data-panel]"));

    function setActive(tabName) {
      tabButtons.forEach((btn) => {
        const isActive = btn.dataset.tab === tabName;
        btn.setAttribute("aria-selected", isActive ? "true" : "false");
        if (isActive) {
          btn.classList.remove("text-gray-700");
          btn.classList.add("bg-gray-900", "text-white");
        } else {
          btn.classList.remove("bg-gray-900", "text-white");
          btn.classList.add("text-gray-700");
        }
      });

      panels.forEach((panel) => {
        panel.hidden = panel.dataset.panel !== tabName;
      });
    }

    document.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-tab]");
      if (!btn) return;
      setActive(btn.dataset.tab);
    });

    // Initialize with upcoming tab active
    setActive("upcoming");
  </script>
</Layout>
