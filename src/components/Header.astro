---
import { Image } from "astro:assets";
import logoWhite from "../assets/logo_white.png";
import logoBlack from "../assets/logo_black.png";
---

<header
  id="site-header"
  class="fixed top-0 left-0 w-full z-50 transition-colors duration-300 bg-transparent"
>
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center relative">
    <h1
      id="site-title"
      class="text-xl font-bold text-white transition-colors duration-300 flex-1 flex justify-center md:justify-start"
    >
      <a
        href="/"
        class="hover:opacity-80 transition-opacity duration-300"
      >
        <Image
          src={logoWhite}
          alt="Álvaro Diana"
          class="h-auto w-30 md:h-16 md:w-16 block transition-opacity duration-300"
          id="logo-white"
        />
        <Image
          src={logoBlack}
          alt="Álvaro Diana"
          class="h-auto w-30 md:h-16 md:w-16 hidden transition-opacity duration-300"
          id="logo-black"
        />
      </a>
    </h1>

    <!-- Hamburger button for mobile -->
    <button
      id="menu-toggle"
      class="md:hidden text-white focus:outline-none  p-2 absolute right-4"
      aria-label="Abrir menú"
      aria-expanded="false"
    >
      <svg
        class="w-8 h-8"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    <nav class="hidden md:block">
      <ul
        id="desktop-menu"
        class="hidden md:flex md:flex-row md:gap-6 absolute md:static top-full left-0 w-full md:w-auto bg-black md:bg-transparent uppercase"
      >
        <li>
          <a
            href="/biografia"
            class="block px-4 py-2 text-white hover:underline font-semibold">Biografía</a
          >
        </li>
        <li>
          <a href="/eventos" class="block px-4 py-2 text-white hover:underline font-semibold"
            >Eventos</a
          >
        </li>
        <li>
          <a
            href="/repertorio"
            class="block px-4 py-2 text-white hover:underline font-semibold">Repertorio</a
          >
        </li>
        <li>
          <a href="/fotos" class="block px-4 py-2 text-white hover:underline font-semibold"
            >Fotos</a
          >
        </li>
        <li>
          <a href="/videos" class="block px-4 py-2 text-white hover:underline font-semibold"
            >Videos</a
          >
        </li>

        <li>
          <a href="/contacto" class="block px-4 py-2 text-white hover:underline font-semibold"
            >Contacto</a
          >
        </li>
      </ul>
    </nav>
  </div>
</header>

<!-- Mobile menu modal (shown only on small screens) -->
<div
  id="mobile-menu-modal"
  class="fixed inset-0 bg-black bg-opacity-95 hidden z-50 md:hidden"
  role="dialog"
  aria-modal="true"
  aria-hidden="true"
>
<div class="flex p-4 items-center justify-center relative">
 <a href="/" class="flex justify-center" aria-label="Álvaro Diana">
      <Image
        src={logoWhite}
        alt="Álvaro Diana"
        id="modal-logo-white"
        class="h-auto w-30 md:h-16 md:w-16"
      />
    </a>
      <button
      id="mobile-menu-close"
      aria-label="Cerrar menú"
      class="text-white focus:outline-none p-2 absolute right-4"
    >
      ✕
    </button>
</div>


  <nav class="h-full flex items-start justify-center mt-4">
      <ul
      id="mobile-menu"
      class="flex flex-col items-center gap-6 text-white text-lg uppercase"
    >
          <li><a href="/" class="px-4 py-2 font-semibold">Inicio</a></li>
      <li><a href="/biografia" class="px-4 py-2 font-semibold">Biografía</a></li>
      <li><a href="/eventos" class="px-4 py-2 font-semibold">Eventos</a></li>
      <li><a href="/repertorio" class="px-4 py-2 font-semibold">Repertorio</a></li>
      <li><a href="/fotos" class="px-4 py-2 font-semibold">Fotos</a></li>
      <li><a href="/videos" class="px-4 py-2 font-semibold">Videos</a></li>
      <li><a href="/contacto" class="px-4 py-2 font-semibold">Contacto</a></li>
    </ul>
  </nav>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const header = document.getElementById("site-header");
    const title = document.getElementById("site-title");
    const menuToggle = document.getElementById("menu-toggle");
    const desktopMenu = document.getElementById("desktop-menu");
    const mobileModal = document.getElementById("mobile-menu-modal");
    const mobileClose = document.getElementById("mobile-menu-close");
    const desktopLinks = desktopMenu ? desktopMenu.querySelectorAll("a") : [];
    const mobileLinks = mobileModal ? mobileModal.querySelectorAll("a") : [];
    const logoWhite = document.getElementById("logo-white");
    const logoBlack = document.getElementById("logo-black");

    if (!header || !title) return;

    const isDesktop = () => window.matchMedia("(min-width: 768px)").matches;

    const applyDesktopScrolled = () => {
      header.classList.add("bg-white", "shadow-md");
      header.classList.remove("bg-transparent");
      title.classList.remove("text-white");
      title.classList.add("text-black");
      if (logoWhite && logoBlack) {
        logoWhite.classList.add("hidden");
        logoBlack.classList.remove("hidden");
      }
      desktopLinks.forEach((a) => {
        a.classList.remove("text-white");
        a.classList.add("text-black");
      });
      if (menuToggle) {
        menuToggle.classList.remove("text-white");
        menuToggle.classList.add("text-black");
      }
    };

    const applyDesktopTop = () => {
      if (logoWhite && logoBlack) {
        logoWhite.classList.remove("hidden");
        logoBlack.classList.add("hidden");
      }
      header.classList.remove("bg-white", "shadow-md");
      header.classList.add("bg-transparent");
      title.classList.remove("text-black");
      title.classList.add("text-white");
      desktopLinks.forEach((a) => {
        a.classList.remove("text-black");
        a.classList.add("text-white");
      });
      if (menuToggle) {
        menuToggle.classList.remove("text-black");
        menuToggle.classList.add("text-white");
      }
    };

    const onScroll = () => {
      if (window.scrollY > 50) applyDesktopScrolled();
      else applyDesktopTop();
    };

    // Prevent background scroll when modal is open
    const openMobileModal = () => {
      if (!mobileModal) return;
      mobileModal.classList.remove("hidden");
      mobileModal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
      if (menuToggle) menuToggle.setAttribute("aria-expanded", "true");
    };

    const closeMobileModal = () => {
      if (!mobileModal) return;
      mobileModal.classList.add("hidden");
      mobileModal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
      if (menuToggle) menuToggle.setAttribute("aria-expanded", "false");
    };

    // Event listeners
    window.addEventListener("scroll", onScroll, { passive: true });
    window.addEventListener("resize", onScroll);
    onScroll();

    if (menuToggle) {
      menuToggle.addEventListener("click", (e) => {
        if (!isDesktop()) {
          openMobileModal();
        } else if (desktopMenu) {
          desktopMenu.classList.toggle("hidden");
        }
      });
    }

    if (mobileClose) {
      mobileClose.addEventListener("click", closeMobileModal);
    }

    if (mobileModal) {
      // close when clicking the overlay outside the nav
      mobileModal.addEventListener("click", (ev) => {
        if (ev.target === mobileModal) closeMobileModal();
      });
    }

    // close modal when a mobile link is clicked
    mobileLinks.forEach((a) => {
      a.addEventListener("click", () => closeMobileModal());
    });
  });
</script>
